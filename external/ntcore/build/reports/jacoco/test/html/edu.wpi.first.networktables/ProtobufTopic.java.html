<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>ProtobufTopic.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">ntcore</a> &gt; <a href="index.source.html" class="el_package">edu.wpi.first.networktables</a> &gt; <span class="el_source">ProtobufTopic.java</span></div><h1>ProtobufTopic.java</h1><pre class="source lang-java linenums">// Copyright (c) FIRST and other WPILib contributors.
// Open Source Software; you can modify and/or share it under the terms of
// the WPILib BSD license file in the root directory of this project.

package edu.wpi.first.networktables;

import edu.wpi.first.util.protobuf.Protobuf;
import edu.wpi.first.util.protobuf.ProtobufBuffer;

/**
 * NetworkTables protobuf-encoded value topic.
 *
 * @param &lt;T&gt; value class
 */
public final class ProtobufTopic&lt;T&gt; extends Topic {
  private ProtobufTopic(Topic topic, Protobuf&lt;T, ?&gt; proto) {
<span class="nc" id="L17">    super(topic.m_inst, topic.m_handle);</span>
<span class="nc" id="L18">    m_proto = proto;</span>
<span class="nc" id="L19">  }</span>

  private ProtobufTopic(NetworkTableInstance inst, int handle, Protobuf&lt;T, ?&gt; proto) {
<span class="nc" id="L22">    super(inst, handle);</span>
<span class="nc" id="L23">    m_proto = proto;</span>
<span class="nc" id="L24">  }</span>

  /**
   * Create a ProtobufTopic from a generic topic.
   *
   * @param &lt;T&gt; value class (inferred from proto)
   * @param topic generic topic
   * @param proto protobuf serialization implementation
   * @return ProtobufTopic for value class
   */
  public static &lt;T&gt; ProtobufTopic&lt;T&gt; wrap(Topic topic, Protobuf&lt;T, ?&gt; proto) {
<span class="nc" id="L35">    return new ProtobufTopic&lt;T&gt;(topic, proto);</span>
  }

  /**
   * Create a ProtobufTopic from a native handle; generally NetworkTableInstance.getProtobufTopic()
   * should be used instead.
   *
   * @param &lt;T&gt; value class (inferred from proto)
   * @param inst Instance
   * @param handle Native handle
   * @param proto protobuf serialization implementation
   * @return ProtobufTopic for value class
   */
  public static &lt;T&gt; ProtobufTopic&lt;T&gt; wrap(
      NetworkTableInstance inst, int handle, Protobuf&lt;T, ?&gt; proto) {
<span class="nc" id="L50">    return new ProtobufTopic&lt;T&gt;(inst, handle, proto);</span>
  }

  /**
   * Create a new subscriber to the topic.
   *
   * &lt;p&gt;The subscriber is only active as long as the returned object is not closed.
   *
   * &lt;p&gt;Subscribers that do not match the published data type do not return any values. To determine
   * if the data type matches, use the appropriate Topic functions.
   *
   * @param defaultValue default value used when a default is not provided to a getter function
   * @param options subscribe options
   * @return subscriber
   */
  public ProtobufSubscriber&lt;T&gt; subscribe(T defaultValue, PubSubOption... options) {
<span class="nc" id="L66">    return new ProtobufEntryImpl&lt;T&gt;(</span>
        this,
<span class="nc" id="L68">        ProtobufBuffer.create(m_proto),</span>
<span class="nc" id="L69">        NetworkTablesJNI.subscribe(</span>
<span class="nc" id="L70">            m_handle, NetworkTableType.kRaw.getValue(), m_proto.getTypeString(), options),</span>
        defaultValue,
        false);
  }

  /**
   * Create a new publisher to the topic.
   *
   * &lt;p&gt;The publisher is only active as long as the returned object is not closed.
   *
   * &lt;p&gt;It is not possible to publish two different data types to the same topic. Conflicts between
   * publishers are typically resolved by the server on a first-come, first-served basis. Any
   * published values that do not match the topic's data type are dropped (ignored). To determine if
   * the data type matches, use the appropriate Topic functions.
   *
   * @param options publish options
   * @return publisher
   */
  public ProtobufPublisher&lt;T&gt; publish(PubSubOption... options) {
<span class="nc" id="L89">    m_inst.addSchema(m_proto);</span>
<span class="nc" id="L90">    return new ProtobufEntryImpl&lt;T&gt;(</span>
        this,
<span class="nc" id="L92">        ProtobufBuffer.create(m_proto),</span>
<span class="nc" id="L93">        NetworkTablesJNI.publish(</span>
<span class="nc" id="L94">            m_handle, NetworkTableType.kRaw.getValue(), m_proto.getTypeString(), options),</span>
        null,
        true);
  }

  /**
   * Create a new publisher to the topic, with type string and initial properties.
   *
   * &lt;p&gt;The publisher is only active as long as the returned object is not closed.
   *
   * &lt;p&gt;It is not possible to publish two different data types to the same topic. Conflicts between
   * publishers are typically resolved by the server on a first-come, first-served basis. Any
   * published values that do not match the topic's data type are dropped (ignored). To determine if
   * the data type matches, use the appropriate Topic functions.
   *
   * @param properties JSON properties
   * @param options publish options
   * @return publisher
   * @throws IllegalArgumentException if properties is not a JSON object
   */
  public ProtobufPublisher&lt;T&gt; publishEx(String properties, PubSubOption... options) {
<span class="nc" id="L115">    m_inst.addSchema(m_proto);</span>
<span class="nc" id="L116">    return new ProtobufEntryImpl&lt;T&gt;(</span>
        this,
<span class="nc" id="L118">        ProtobufBuffer.create(m_proto),</span>
<span class="nc" id="L119">        NetworkTablesJNI.publishEx(</span>
            m_handle,
<span class="nc" id="L121">            NetworkTableType.kRaw.getValue(),</span>
<span class="nc" id="L122">            m_proto.getTypeString(),</span>
            properties,
            options),
        null,
        true);
  }

  /**
   * Create a new entry for the topic.
   *
   * &lt;p&gt;Entries act as a combination of a subscriber and a weak publisher. The subscriber is active
   * as long as the entry is not closed. The publisher is created when the entry is first written
   * to, and remains active until either unpublish() is called or the entry is closed.
   *
   * &lt;p&gt;It is not possible to use two different data types with the same topic. Conflicts between
   * publishers are typically resolved by the server on a first-come, first-served basis. Any
   * published values that do not match the topic's data type are dropped (ignored), and the entry
   * will show no new values if the data type does not match. To determine if the data type matches,
   * use the appropriate Topic functions.
   *
   * @param defaultValue default value used when a default is not provided to a getter function
   * @param options publish and/or subscribe options
   * @return entry
   */
  public ProtobufEntry&lt;T&gt; getEntry(T defaultValue, PubSubOption... options) {
<span class="nc" id="L147">    return new ProtobufEntryImpl&lt;T&gt;(</span>
        this,
<span class="nc" id="L149">        ProtobufBuffer.create(m_proto),</span>
<span class="nc" id="L150">        NetworkTablesJNI.getEntry(</span>
<span class="nc" id="L151">            m_handle, NetworkTableType.kRaw.getValue(), m_proto.getTypeString(), options),</span>
        defaultValue,
        false);
  }

  public Protobuf&lt;T, ?&gt; getProto() {
<span class="nc" id="L157">    return m_proto;</span>
  }

  @Override
  public boolean equals(Object other) {
<span class="nc bnc" id="L162" title="All 2 branches missed.">    if (other == this) {</span>
<span class="nc" id="L163">      return true;</span>
    }
<span class="nc bnc" id="L165" title="All 2 branches missed.">    if (!(other instanceof ProtobufTopic)) {</span>
<span class="nc" id="L166">      return false;</span>
    }

<span class="nc bnc" id="L169" title="All 4 branches missed.">    return super.equals(other) &amp;&amp; m_proto == ((ProtobufTopic&lt;?&gt;) other).m_proto;</span>
  }

  @Override
  public int hashCode() {
<span class="nc" id="L174">    return super.hashCode() ^ m_proto.hashCode();</span>
  }

  private final Protobuf&lt;T, ?&gt; m_proto;
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.10.202304240956</span></div></body></html>
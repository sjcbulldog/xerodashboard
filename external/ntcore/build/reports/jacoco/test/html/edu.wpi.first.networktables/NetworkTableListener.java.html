<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>NetworkTableListener.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">ntcore</a> &gt; <a href="index.source.html" class="el_package">edu.wpi.first.networktables</a> &gt; <span class="el_source">NetworkTableListener.java</span></div><h1>NetworkTableListener.java</h1><pre class="source lang-java linenums">// Copyright (c) FIRST and other WPILib contributors.
// Open Source Software; you can modify and/or share it under the terms of
// the WPILib BSD license file in the root directory of this project.

package edu.wpi.first.networktables;

import java.util.EnumSet;
import java.util.function.Consumer;

/**
 * Event listener. This calls back to a callback function when an event matching the specified mask
 * occurs. The callback function is called asynchronously on a separate thread, so it's important to
 * use synchronization or atomics when accessing any shared state from the callback function.
 */
public final class NetworkTableListener implements AutoCloseable {
  /**
   * Create a listener for changes to topics with names that start with any of the given prefixes.
   * This creates a corresponding internal subscriber with the lifetime of the listener.
   *
   * @param inst Instance
   * @param prefixes Topic name string prefixes
   * @param eventKinds set of event kinds to listen to
   * @param listener Listener function
   * @return Listener
   */
  public static NetworkTableListener createListener(
      NetworkTableInstance inst,
      String[] prefixes,
      EnumSet&lt;NetworkTableEvent.Kind&gt; eventKinds,
      Consumer&lt;NetworkTableEvent&gt; listener) {
<span class="nc" id="L31">    return new NetworkTableListener(inst, inst.addListener(prefixes, eventKinds, listener));</span>
  }

  /**
   * Create a listener for changes on a particular topic. This creates a corresponding internal
   * subscriber with the lifetime of the listener.
   *
   * @param topic Topic
   * @param eventKinds set of event kinds to listen to
   * @param listener Listener function
   * @return Listener
   */
  public static NetworkTableListener createListener(
      Topic topic,
      EnumSet&lt;NetworkTableEvent.Kind&gt; eventKinds,
      Consumer&lt;NetworkTableEvent&gt; listener) {
<span class="nc" id="L47">    NetworkTableInstance inst = topic.getInstance();</span>
<span class="nc" id="L48">    return new NetworkTableListener(inst, inst.addListener(topic, eventKinds, listener));</span>
  }

  /**
   * Create a listener for topic changes on a subscriber. This does NOT keep the subscriber active.
   *
   * @param subscriber Subscriber
   * @param eventKinds set of event kinds to listen to
   * @param listener Listener function
   * @return Listener
   */
  public static NetworkTableListener createListener(
      Subscriber subscriber,
      EnumSet&lt;NetworkTableEvent.Kind&gt; eventKinds,
      Consumer&lt;NetworkTableEvent&gt; listener) {
<span class="nc" id="L63">    NetworkTableInstance inst = subscriber.getTopic().getInstance();</span>
<span class="nc" id="L64">    return new NetworkTableListener(inst, inst.addListener(subscriber, eventKinds, listener));</span>
  }

  /**
   * Create a listener for topic changes on a subscriber. This does NOT keep the subscriber active.
   *
   * @param subscriber Subscriber
   * @param eventKinds set of event kinds to listen to
   * @param listener Listener function
   * @return Listener
   */
  public static NetworkTableListener createListener(
      MultiSubscriber subscriber,
      EnumSet&lt;NetworkTableEvent.Kind&gt; eventKinds,
      Consumer&lt;NetworkTableEvent&gt; listener) {
<span class="nc" id="L79">    NetworkTableInstance inst = subscriber.getInstance();</span>
<span class="nc" id="L80">    return new NetworkTableListener(inst, inst.addListener(subscriber, eventKinds, listener));</span>
  }

  /**
   * Create a listener for topic changes on an entry.
   *
   * @param entry Entry
   * @param eventKinds set of event kinds to listen to
   * @param listener Listener function
   * @return Listener
   */
  public static NetworkTableListener createListener(
      NetworkTableEntry entry,
      EnumSet&lt;NetworkTableEvent.Kind&gt; eventKinds,
      Consumer&lt;NetworkTableEvent&gt; listener) {
<span class="nc" id="L95">    NetworkTableInstance inst = entry.getInstance();</span>
<span class="nc" id="L96">    return new NetworkTableListener(inst, inst.addListener(entry, eventKinds, listener));</span>
  }

  /**
   * Create a connection listener.
   *
   * @param inst instance
   * @param immediateNotify notify listener of all existing connections
   * @param listener listener function
   * @return Listener
   */
  public static NetworkTableListener createConnectionListener(
      NetworkTableInstance inst, boolean immediateNotify, Consumer&lt;NetworkTableEvent&gt; listener) {
<span class="nc" id="L109">    return new NetworkTableListener(inst, inst.addConnectionListener(immediateNotify, listener));</span>
  }

  /**
   * Create a time synchronization listener.
   *
   * @param inst instance
   * @param immediateNotify notify listener of current time synchronization value
   * @param listener listener function
   * @return Listener
   */
  public static NetworkTableListener createTimeSyncListener(
      NetworkTableInstance inst, boolean immediateNotify, Consumer&lt;NetworkTableEvent&gt; listener) {
<span class="nc" id="L122">    return new NetworkTableListener(inst, inst.addTimeSyncListener(immediateNotify, listener));</span>
  }

  /**
   * Create a listener for log messages. By default, log messages are sent to stderr; this function
   * sends log messages with the specified levels to the provided callback function instead. The
   * callback function will only be called for log messages with level greater than or equal to
   * minLevel and less than or equal to maxLevel; messages outside this range will be silently
   * ignored.
   *
   * @param inst instance
   * @param minLevel minimum log level
   * @param maxLevel maximum log level
   * @param listener listener function
   * @return Listener
   */
  public static NetworkTableListener createLogger(
      NetworkTableInstance inst, int minLevel, int maxLevel, Consumer&lt;NetworkTableEvent&gt; listener) {
<span class="nc" id="L140">    return new NetworkTableListener(inst, inst.addLogger(minLevel, maxLevel, listener));</span>
  }

  @Override
  public synchronized void close() {
<span class="nc bnc" id="L145" title="All 2 branches missed.">    if (m_handle != 0) {</span>
<span class="nc" id="L146">      m_inst.removeListener(m_handle);</span>
<span class="nc" id="L147">      m_handle = 0;</span>
    }
<span class="nc" id="L149">  }</span>

  /**
   * Determines if the native handle is valid.
   *
   * @return True if the native handle is valid, false otherwise.
   */
  public boolean isValid() {
<span class="nc bnc" id="L157" title="All 2 branches missed.">    return m_handle != 0;</span>
  }

  /**
   * Gets the native handle.
   *
   * @return Native handle
   */
  public int getHandle() {
<span class="nc" id="L166">    return m_handle;</span>
  }

  /**
   * Wait for the topic listener queue to be empty. This is primarily useful for deterministic
   * testing. This blocks until either the topic listener queue is empty (e.g. there are no more
   * events that need to be passed along to callbacks or poll queues) or the timeout expires.
   *
   * @param timeout timeout, in seconds. Set to 0 for non-blocking behavior, or a negative value to
   *     block indefinitely
   * @return False if timed out, otherwise true.
   */
  public boolean waitForQueue(double timeout) {
<span class="nc" id="L179">    return m_inst.waitForListenerQueue(timeout);</span>
  }

<span class="nc" id="L182">  private NetworkTableListener(NetworkTableInstance inst, int handle) {</span>
<span class="nc" id="L183">    m_inst = inst;</span>
<span class="nc" id="L184">    m_handle = handle;</span>
<span class="nc" id="L185">  }</span>

  private final NetworkTableInstance m_inst;
  private int m_handle;
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.10.202304240956</span></div></body></html>